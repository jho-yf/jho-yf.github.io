# 中间件面试题



## MySQL

### 索引

#### MySQL什么时候建立索引

**索引（Index）**是帮助MySQL高效获取数据的**数据结构**。**索引的本质是数据结构。**

一般来说索引本身也很大，不可能全部存储在内存中，因此索引往往以索引文件的形式存储的磁盘上。

**优势：**

- 提高**数据检索**效率，降低数据库的IO成本。如：大学图书馆建立数目索引。
- 通过索引列对数据进行排序，降低数据排序的成本（排序快），降低CPU的消耗。

**劣势：**

- **降低了更新表的速度**（对表的`INSERT`、`UPDATE`和`DELETE`操作），更新表时，MySQL不仅要保存数据，还要保存索引文件每次更新添加了索引列的字段，都需要调整相应的索引信息。
- **索引列占用一定的磁盘空间**，实际上索引也是一张表，该表保存主键与索引字段，并且执行实体表的记录

**需要创建索引的情况**：

- 主键自动建立唯一索引
- 频繁作为**查询条件**的字段应该创建索引
- 查询中与**其他表关联的字段，外键关系**建立索引
- 组合索引比单键性价比更高
- 查询中排序字段应该创建索引，**排序字段**若通过索引去访问将大大提高排序速度
- 查询中**统计**或者**分组字段**

**不建议创建索引的情况：**

- 表记录太少
- 经常增删改的表或者字段
- where条件里用不到的字段不创建索引
- 过滤性不好的不适合建索引（过滤性好的字段：手机号、身份证号等。过滤性不好的字段：性别等）



## Redis

### 持久化

#### Redis持久化有几种类型以及他们之间的区别

Redis提供两种不同形式的持久化方式：**RDB**（Redis Database）和**AOF**（Append Of File）

##### RDB

在指定的时间间隔内将内存中的**数据集快照**写入磁盘，也就是`Snapshot`快照，它恢复时是将快照文件直接读到内存中。

```mermaid
graph LR
	memory((内存中的数据对象)) --> |rdbSave| disk((磁盘中的RDB文件))
	disk --> |rabLoad|memory
```



**备份如何执行：**Redis会单独创建（fork）一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。整个过程中，主进程是不进行任何IO操作的，这就确保了极高的性能，且对于数据恢复的完整性不是非常敏感。

**优点：**

- RDB方式会比AOF方式更加的高效，恢复速度快。
- 节省磁盘空间。

**缺点：**

- 虽然Redis在fork时使用写时拷贝技术，但是在数据量庞大的时候还是比较耗性能的。
- 在一定时间间隔做一次备份，如果Redis意外宕机的话，就会丢失最后一次快照的所有修改。

##### AOF

以**日志的形式来记录每个写操作**，将Redis执行过的所有**写指令都记录下来（读操作不记录）**，只许追加日志文件但不可以改写日志文件，Redis启动之初会读取该文件重新构建数据。换言之，Redis重启的话就根据日志文件的内容，将写指令从前到后执行一次以完成数据的恢复工作。

```mermaid
graph LR
	client((客户端)) -.-> |命令请求| server((服务端)) -.-> |追加网络协议格式的命令内容| aof((AOF文件))
```

**优点：**

- 备份机制更稳健，丢失数据概率更低
- 可读的日志文本，通过操作AOF文件，可以处理误操作

**缺点：**

- 比RDB占用更多的磁盘空间
- 恢复备份速度比较慢
- 每次读写都同步的话，会有一定的性能压力
- 存在个别BUG，造成无法恢复



### 其他

#### Redis在项目中的使用场景

| 数据类型 | 使用场景 |
| -------- | -------- |
| String   |          |
| Hash     |          |
| List     |          |
| Set      |          |
| Zset     |          |



## Elasticsearch

### Elasticsearch和Solr的区别

它们都是基于`Lucene`引擎基础上开发的**高性能**企业级搜索服务器，都是使用Java语言开发的

**高性能：**之所以说高性能，是因为它们都是**基于分词技术**构建的**倒排索引**的方式进行查询的

**区别：**

- 当实时建立索引的时候，Solr会产生IO阻塞，ES不会，所以ES的查询性能比Solr高。
- 在不断动态添加数据的时候，Solr的检索效率会变得低下，ES不会产生任何变化。
- Solr利用zookeeper进行分布式管理，ES自带分布式系统管理功能。
- Solr支持更多的数据格式（xml、json、csv等），ES只支持json文件格式。
- 单纯对已有数据进行检索的时候，Solr效率更好。若要求数据是动态变化的，要求实时搜索，ES效率更高。
